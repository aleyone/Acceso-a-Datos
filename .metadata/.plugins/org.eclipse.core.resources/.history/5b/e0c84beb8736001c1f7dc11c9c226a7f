package es.addbl3.AE3;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Scanner;

import javax.xml.parsers.*;
import org.w3c.dom.*;
import org.xml.sax.SAXException;

class Libro {
	private int identificador;
	private String titulo, autor, año, editorial, numpag;

	Libro(int identificador, String titulo, String autor, String año, String editorial, String numpag) {
		this.identificador = identificador;
		this.titulo = titulo;
		this.autor = autor;
		this.año = año;
		this.editorial = editorial;
		this.numpag = numpag;
	}

	public int crearLibro(Libro libro) {
		try {
			DocumentBuilderFactory dFact = DocumentBuilderFactory.newInstance();
			DocumentBuilder dBuild = dFact.newDocumentBuilder();
			Document doc = dBuild.newDocument();
			Element raiz=doc.createElement("biblioteca");
			doc.appendChild(raiz);
			Element libro1=doc.createElement("libro");
			raiz.appendChild(libro1);
			Element id=doc.createElement("identificador");
			id.appendChild(doc.createTextNode(String.valueOf(libro.identificador)));
			libro1.appendChild(id);
			Element titulo=doc.createElement("titulo");
			titulo.appendChild(doc.createTextNode(String.valueOf(libro.titulo)));
			libro1.appendChild(titulo);
			Element autor=doc.createElement("autor");
			autor.appendChild(doc.createTextNode(String.valueOf(libro.autor)));
			libro1.appendChild(autor);
			
			
		} catch (ParserConfigurationException e) {
			e.printStackTrace();
		}
		
		return libro.identificador;
	}

//	public Libro recuperarLibro (int identificador) {
//		
//		return libro;
//	}

	public void mostrarLibro(Libro libro) {
		System.out.println(
				"Id: " + String.valueOf(libro.identificador) + "\nTítulo: " + libro.titulo + "\nAutor: " + libro.autor
						+ "\nAño: " + libro.año + "\nEditorial: " + libro.editorial + "\nNº páginas: " + libro.numpag+"\n");
	}

	public void borrarLibro(int identificador) {

	}

	public void actualizarLibro(int identificador) {

	}

	// public class Biblioteca {

	public ArrayList<Libro> recuperarTodos() {
		ArrayList<Libro> listado = new ArrayList<Libro>();
		try {
			DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
			DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
			Document doc = dBuilder.parse(new File("biblioteca.xml"));
			Element raiz = doc.getDocumentElement();
			NodeList nodeList = doc.getElementsByTagName("libro");
			for (int i = 0; i < nodeList.getLength(); i++) {
				Node node = nodeList.item(i);
				Element element = (Element) node;
				int id = Integer.parseInt(element.getElementsByTagName("identificador").item(0).getTextContent());
				String tit = element.getElementsByTagName("titulo").item(0).getTextContent();
				String aut = element.getElementsByTagName("autor").item(0).getTextContent();
				String any = element.getElementsByTagName("año").item(0).getTextContent();
				String edit = element.getElementsByTagName("editorial").item(0).getTextContent();
				String nump = element.getElementsByTagName("numpag").item(0).getTextContent();
				Libro librosXML = new Libro(id, tit, aut, any, edit, nump);
				listado.add(librosXML);
			}

		} catch (ParserConfigurationException e) {
			e.printStackTrace();
		} catch (SAXException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}		
		for (Libro libros : listado) {
			this.mostrarLibro(libros);
		}
		
		return listado;
	}

//}

}
