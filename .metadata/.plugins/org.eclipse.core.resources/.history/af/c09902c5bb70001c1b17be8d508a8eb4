package es.add.aemongodb;

import java.util.ArrayList;
import java.util.List;

import org.bson.Document;

import com.mongodb.MongoClient;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoCursor;
import com.mongodb.client.MongoDatabase;
import com.mongodb.client.model.Filters;

public class Modelo {
	public MongoCollection createConnection() {
		MongoClient client = new MongoClient ("localhost", 27017);
		MongoDatabase db = client.getDatabase("Discos");
		MongoCollection<Document> collection = db.getCollection("Discos");

		return collection;
	}

	public String listBooks (MongoCollection collection) {
		String unido="";
		List<String> resultado = new ArrayList<String>();
		MongoCursor<Document> cursor= collection.find().iterator();
		while(cursor.hasNext()) {
		String fragmento = cursor.next().toJson();
		resultado.add(fragmento);
		}
		for (int i=0;i<resultado.size();i++) {
			unido += resultado.get(i)+"\n";
		}
		return unido;
	}

	/*public String showBooks(Session session, List listado) {

		String result = "";
		try {
			for (Object n : listado) {
				Libreria libros = (Libreria) n;
				result += libros.AllToText();
			}
		} catch (NullPointerException e) {
			result = "No estás conectado a la BBDD. Conéctate antes: " + e;
		}
		return result;

	}

	public String showOneBook(Session session, int id) {
		String result="";
		Libreria libro= new Libreria();
		try {
		libro = (Libreria) session.get(Libreria.class, id);
		} catch (NullPointerException e) {
			result="No estás conectado a la BBDD. Conéctate antes: "+e;
		}
		result = libro.OneToText();
		return result;
	}

	public String[] detailsBook (Session session, int id) {
		String[] result=new String[6];
		Libreria libro = (Libreria) session.get(Libreria.class, id);
		result[0]=libro.getTitulo();
		result[1]=libro.getAutor();
		result[2]=libro.getAño_nac();
		result[3]=libro.getAño_pub();
		result[4]=libro.getEditorial();
		result[5]=String.valueOf(libro.getNum_pag());
		return result;
	}*/
	
	public void createBook (MongoCollection collection, String grupo, String titulo, int publicacion, String formato) {
		Document doc = new Document();
		doc.append("Grupo", grupo);
		doc.append("Título", titulo);
		doc.append("Año publicación", publicacion);
		doc.append("Formato", formato);
		collection.insertOne(doc);
		
	}

	public void updateBook(Session session, int id, String titulo, String autor, String año_n, String año_p,
			String editorial, int num_p) {
		Libreria libroUpdate = (Libreria) session.load(Libreria.class, id);
		libroUpdate.setTitulo(titulo);
		libroUpdate.setAutor(autor);
		libroUpdate.setAño_nac(año_n);
		libroUpdate.setAño_pub(año_p);
		libroUpdate.setEditorial(editorial);
		libroUpdate.setNum_pag(num_p);
		session.update(libroUpdate);
		session.getTransaction().commit();
	}

	/*public void deleteBook(Session session, int id) {
		Libreria del = new Libreria();
		del.setId(id);
		session.delete(del);
		session.getTransaction().commit();
	}

	public void closeSession(Session session, List listado) {
		listado.clear();
		session.close();
	}*/
}

